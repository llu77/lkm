# ๐ง ุฏููู ุฅุนุฏุงุฏุงุช ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุงูุฌุฏููุฉ

## โ ูุง ุชู ุฅูุฌุงุฒู

ุชู ุฅุถุงูุฉ **Settings Tab** ุดุงูู ูู ุตูุญุฉ System Support (`/system-support`) ูุญุชูู ุนูู:

### 1. โ ุฅุนุฏุงุฏุงุช ุงููุฑุณู (Sender Settings)
**ุงููุฏู:** ุถุจุท ุงุณู ูุจุฑูุฏ ุงููุฑุณู ุงูุงูุชุฑุงุถู

**ุงูุฎุตุงุฆุต:**
- ุงุณู ุงููุฑุณู (ูุธูุฑ ูู ุตูุฏูู ุงููุงุฑุฏ)
- ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูููุฑุณู

**ุงูุงุณุชุฎุฏุงู:**
1. ุงุฐูุจ ุฅูู `/system-support` โ ุชุงุจ "ุฅุนุฏุงุฏุงุช"
2. ุฃุฏุฎู ุงุณู ุงููุฑุณู ูุงูุจุฑูุฏ
3. ุงุถุบุท "ุญูุธ ุงููุฑุณู"

**ุงูููู ุงูุงูุชุฑุงุถูุฉ:**
- ุงูุงุณู: "ูุธุงู ุงูุฅุฏุงุฑุฉ ุงููุงููุฉ"
- ุงูุจุฑูุฏ: "onboarding@resend.dev"

---

### 2. โ ุงููุณุชูููู ุงูุงูุชุฑุงุถููู (Default Recipients)
**ุงููุฏู:** ุญูุธ ูุงุฆูุฉ ุจุงููุณุชูููู ููุงุณุชุฎุฏุงู ุงูุณุฑูุน

**ุงูุฎุตุงุฆุต:**
- ุฅุถุงูุฉ/ุญุฐู ูุณุชูููู
- ูุงุฆูุฉ ูุญููุธุฉ ูุงุจูุฉ ูุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู

**ุงูุงุณุชุฎุฏุงู:**
1. ุฃุฏุฎู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
2. ุงุถุบุท Enter ุฃู ุฒุฑ +
3. ูุฑุฑ ูุฅุถุงูุฉ ุงููุฒูุฏ
4. ุงุถุบุท "ุญูุธ ุงููุณุชูููู"

**ุงูููุฒุงุช:**
- โ ูุชุญูู ูู ุตุญุฉ ุงูุจุฑูุฏ (@)
- โ ูููุน ุงูุชูุฑุงุฑ
- โ ุญุฐู ุณุฑูุน ููู ุจุฑูุฏ

---

### 3. โ ุงูุฌุฏููุฉ ุงูููููุฉ (Daily Schedule - 3:00 AM)
**ุงููุฏู:** ุฅุฑุณุงู ุชูุฑูุฑ ูููู ุชููุงุฆู

**ุงูุฅุนุฏุงุฏุงุช:**
- โ ุชูุนูู/ุฅููุงู
- โ ุงุฎุชูุงุฑ ุงูููุช (ุงูุชุฑุงุถู: 03:00)
- โ ุงุฎุชูุงุฑ ุงููุงูุจ ุฃู ูุต ููุชูุญ:
  - ุชูุฑูุฑ ุฏูุฑู (report template)
  - ุฅุดุนุงุฑ ุนุงู (notification template)
  - ูุต ููุชูุญ (custom HTML)
- โ ุฅุถุงูุฉ ุงููุณุชูููู
- โ ุฒุฑ "ุงุณุชุฎุฏุงู ุงูุงูุชุฑุงุถู" ููุณุฎ ุงููุงุฆูุฉ ุงูุงูุชุฑุงุถูุฉ

**ุงูุงุณุชุฎุฏุงู:**
1. ูุนูู ุงูุฌุฏููุฉ
2. ุงุฎุชุฑ ุงูููุช
3. ุงุฎุชุฑ ุงููุงูุจ (ุฃู "ูุต ููุชูุญ" ูููุญุชูู ุงููุฎุตุต)
4. ุฃุถู ุงููุณุชูููู
5. ุงุถุบุท "ุญูุธ ุงูุฌุฏููุฉ ุงูููููุฉ"

---

### 4. โ ุงูุฌุฏููุฉ ุงูุดูุฑูุฉ (Monthly Schedule - 1st @ 12:00 PM)
**ุงููุฏู:** ุฅุฑุณุงู ุชูุฑูุฑ ุดูุฑู ุชููุงุฆู

**ุงูุฅุนุฏุงุฏุงุช:**
- โ ุชูุนูู/ุฅููุงู
- โ ุงุฎุชูุงุฑ ุงูููู ูู ุงูุดูุฑ (1-28)
- โ ุงุฎุชูุงุฑ ุงูููุช (ุงูุชุฑุงุถู: 12:00)
- โ ุงุฎุชูุงุฑ ุงููุงูุจ ุฃู ูุต ููุชูุญ:
  - ุชูุฑูุฑ ุฏูุฑู (report template)
  - ุฅุดุนุงุฑ ุนุงู (notification template)
  - ูุต ููุชูุญ (custom HTML)
- โ ุฅุถุงูุฉ ุงููุณุชูููู
- โ ุฒุฑ "ุงุณุชุฎุฏุงู ุงูุงูุชุฑุงุถู" ููุณุฎ ุงููุงุฆูุฉ ุงูุงูุชุฑุงุถูุฉ

**ุงูุงุณุชุฎุฏุงู:**
1. ูุนูู ุงูุฌุฏููุฉ
2. ุงุฎุชุฑ ุงูููู ูู ุงูุดูุฑ
3. ุงุฎุชุฑ ุงูููุช
4. ุงุฎุชุฑ ุงููุงูุจ (ุฃู "ูุต ููุชูุญ" ูููุญุชูู ุงููุฎุตุต)
5. ุฃุถู ุงููุณุชูููู
6. ุงุถุบุท "ุญูุธ ุงูุฌุฏููุฉ ุงูุดูุฑูุฉ"

---

## ๐๏ธ ุงูุจููุฉ ุงูุชูููุฉ

### Database Schema
**ุฌุฏูู:** `emailSettings`

```typescript
emailSettings: defineTable({
  settingKey: v.string(),
  settingValue: v.union(
    v.string(),
    v.object({...}),
    v.array(v.string()),
  ),
  updatedAt: v.number(),
}).index("by_key", ["settingKey"])
```

**Keys ุงููุชุงุญุฉ:**
- `sender_name`: ุงุณู ุงููุฑุณู (string)
- `sender_email`: ุจุฑูุฏ ุงููุฑุณู (string)
- `default_recipients`: ูุงุฆูุฉ ุงููุณุชูููู (array)
- `daily_schedule`: ุฅุนุฏุงุฏุงุช ุงูุฌุฏููุฉ ุงูููููุฉ (object)
- `monthly_schedule`: ุฅุนุฏุงุฏุงุช ุงูุฌุฏููุฉ ุงูุดูุฑูุฉ (object)

---

### Backend Functions
**ููู:** `convex/emailSettings.ts`

**Queries:**
- `getSetting({ key })` - ุงูุญุตูู ุนูู ุฅุนุฏุงุฏ ูุงุญุฏ
- `getAllSettings()` - ุงูุญุตูู ุนูู ุฌููุน ุงูุฅุนุฏุงุฏุงุช

**Mutations:**
- `updateSetting({ key, value })` - ุชุญุฏูุซ ุฅุนุฏุงุฏ ุนุงู
- `updateSenderSettings({ senderName, senderEmail })` - ุชุญุฏูุซ ุงููุฑุณู
- `updateDefaultRecipients({ recipients })` - ุชุญุฏูุซ ุงููุณุชูููู
- `updateDailySchedule({ enabled, time, templateId, customContent, recipients })` - ุชุญุฏูุซ ุงูุฌุฏููุฉ ุงูููููุฉ
- `updateMonthlySchedule({ enabled, day, time, templateId, customContent, recipients })` - ุชุญุฏูุซ ุงูุฌุฏููุฉ ุงูุดูุฑูุฉ

---

### Frontend Components
**ููู:** `src/pages/system-support/page.tsx`

**Component:** `SettingsTabContent`

**State Management:**
- โ useQuery ูุชุญููู ุงูุฅุนุฏุงุฏุงุช
- โ useMutation ูุญูุธ ุงูุชุญุฏูุซุงุช
- โ useState ููู UI state
- โ useEffect ูุชุญููู ุงูุจูุงูุงุช ุนูุฏ ุงูุชุญุฏูุซ

---

## ๐ ุงูุฑุจุท ูุน Zapier

### Option 1: Zapier Schedule (ููุตู ุจู)

#### ููุฌุฏููุฉ ุงูููููุฉ (3:00 AM):
```
1. ุฅูุดุงุก Zap ุฌุฏูุฏ
2. Trigger: Schedule by Zapier
   - Frequency: Every Day
   - Time: 3:00 AM
   - Timezone: Asia/Riyadh
3. Action: Webhooks by Zapier
   - Method: POST
   - URL: [ุงูู webhook URL ูู ุชุงุจ Zapier]
   - Payload:
     {
       "eventType": "daily_email_scheduled",
       "timestamp": "{{zap_meta_human_now}}"
     }
4. Action 2: Email by Resend (ุฃู Gmail)
   - To: [ูุฑุงุกุฉ ูู ุงูุฅุนุฏุงุฏุงุช ุฃู ุซุงุจุช]
   - Subject: "ุชูุฑูุฑ ูููู"
   - Body: [ูุฑุงุกุฉ ูู ุงูุฅุนุฏุงุฏุงุช ุฃู ูุงูุจ]
```

#### ููุฌุฏููุฉ ุงูุดูุฑูุฉ (1st @ 12:00 PM):
```
1. ุฅูุดุงุก Zap ุฌุฏูุฏ
2. Trigger: Schedule by Zapier
   - Frequency: Every Month
   - Day: 1
   - Time: 12:00 PM
   - Timezone: Asia/Riyadh
3. Action: Webhooks by Zapier
   - Method: POST
   - URL: [ุงูู webhook URL ูู ุชุงุจ Zapier]
   - Payload:
     {
       "eventType": "monthly_email_scheduled",
       "timestamp": "{{zap_meta_human_now}}"
     }
4. Action 2: Email by Resend (ุฃู Gmail)
   - To: [ูุฑุงุกุฉ ูู ุงูุฅุนุฏุงุฏุงุช ุฃู ุซุงุจุช]
   - Subject: "ุชูุฑูุฑ ุดูุฑู"
   - Body: [ูุฑุงุกุฉ ูู ุงูุฅุนุฏุงุฏุงุช ุฃู ูุงูุจ]
```

---

### Option 2: Convex Scheduler (ุจุฏูู)

ุงุณุชุฎุฏู `convex/clearRevenues.ts`:
- โ `initializeScheduling()` - ูุจุฏุก ุงูุฌุฏููุฉ
- โ `dailyTask3AM()` - ุงููููุฉ ุงูููููุฉ
- โ `monthlyTask1st()` - ุงููููุฉ ุงูุดูุฑูุฉ

**ููุงุญุธุฉ:** Convex Scheduler ูุญุชุงุฌ re-scheduling ุจุนุฏ ูู ุชุดุบููุ ุจูููุง Zapier Schedule ุชููุงุฆู ุจุงููุงูู.

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู ุงููุงูู

### Workflow ูุงูู:

```
1. ุฅุนุฏุงุฏ ุงููุฑุณู
   โ
2. ุฅุถุงูุฉ ุงููุณุชูููู ุงูุงูุชุฑุงุถููู
   โ
3. ุชูุนูู ุงูุฌุฏููุฉ ุงูููููุฉ/ุงูุดูุฑูุฉ
   โ
4. ุงุฎุชูุงุฑ ุงููุงูุจ ุฃู ูุชุงุจุฉ ูุต ููุชูุญ
   โ
5. ุฅุถุงูุฉ ุงููุณุชูููู (ุฃู ุงุณุชุฎุฏุงู ุงูุงูุชุฑุงุถู)
   โ
6. ุญูุธ ุงูุฅุนุฏุงุฏุงุช
   โ
7. ุฅุนุฏุงุฏ Zapier Schedule
   โ
8. ุงุฎุชุจุงุฑ ุงูุชุดุบูู
```

---

## ๐ฏ ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

### โ ุงููุฑุณู
- ุถุจุท ุงูุงุณู ูุงูุจุฑูุฏ
- ูุธูุฑ ูู ุฌููุน ุงูุฑุณุงุฆู ุงูููุฑุณูุฉ

### โ ุงููุณุชูููู ุงูุงูุชุฑุงุถููู
- ูุงุฆูุฉ ูุญููุธุฉ
- ุงุณุชุฎุฏุงู ุณุฑูุน ูู ุงูุฌุฏููุงุช

### โ ุงูุฌุฏููุฉ ุงูููููุฉ
- ููุช ูุงุจู ููุชุฎุตูุต
- 3 ุฎูุงุฑุงุช: ูุงูุจ ุฏูุฑูุ ุฅุดุนุงุฑุ ูุต ููุชูุญ
- ูุณุชูููู ูุฎุตุตูู ุฃู ุงูุชุฑุงุถููู

### โ ุงูุฌุฏููุฉ ุงูุดูุฑูุฉ
- ููู ูููุช ูุงุจูุงู ููุชุฎุตูุต
- 3 ุฎูุงุฑุงุช: ูุงูุจ ุฏูุฑูุ ุฅุดุนุงุฑุ ูุต ููุชูุญ
- ูุณุชูููู ูุฎุตุตูู ุฃู ุงูุชุฑุงุถููู

### โ ุงููุต ุงูููุชูุญ
- ุฏุนู ูุงูู ูู HTML
- ูุญุฑุฑ ูุตู ูุจูุฑ (6 ุฃุณุทุฑ)
- ูุนุงููุฉ ูุชุงุญุฉ ูู ุชุงุจ ุงูููุงูุจ

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

### 1. ุชุฌุฑุจุฉ ุงูุฅุนุฏุงุฏุงุช
```
1. ุงุฐูุจ ุฅูู /system-support
2. ุงุถุบุท ุนูู ุชุงุจ "ุฅุนุฏุงุฏุงุช"
3. ุฃุฏุฎู ุจูุงูุงุชู
4. ุงุถุบุท ุญูุธ
```

### 2. ุฅุนุฏุงุฏ Zapier
```
1. ุงูุชุญ Zapier
2. ุฃูุดุฆ Zap ููุฌุฏููุฉ ุงูููููุฉ (3:00 AM)
3. ุฃูุดุฆ Zap ููุฌุฏููุฉ ุงูุดูุฑูุฉ (1st @ 12:00 PM)
4. ุงุฎุชุจุฑ ุงูุชุดุบูู
```

### 3. ุงุฎุชุจุงุฑ ุงููุธุงู
```
1. ุฃุฑุณู ุจุฑูุฏ ุชุฌุฑูุจู ูู ุชุงุจ "ุฅุฑุณุงู ุจุฑูุฏ"
2. ุชุญูู ูู ุงุณุชุฎุฏุงู ุฅุนุฏุงุฏุงุช ุงููุฑุณู
3. ุฑุงูุจ ุงูุณุฌู ูู ุชุงุจ "ุงูุณุฌู"
```

---

## ๐ ุฎูุงุตุฉ ุงูุฅูุฌุงุฒ

**ุชู ุฅุถุงูุฉ:**
โ Settings Tab ุดุงูู
โ ุฅุนุฏุงุฏุงุช ุงููุฑุณู (ุงุณู + ุจุฑูุฏ)
โ ูุงุฆูุฉ ุงููุณุชูููู ุงูุงูุชุฑุงุถููู
โ ุฌุฏููุฉ ููููุฉ (3:00 AM)
โ ุฌุฏููุฉ ุดูุฑูุฉ (1 @ 12:00 PM)
โ ุฏุนู ุงูููุงูุจ ุงูุฌุงูุฒุฉ
โ ุฏุนู ุงููุต ุงูููุชูุญ (HTML)
โ UI/UX ุงุญุชุฑุงูู
โ ุฑุจุท ูุน Zapier
โ ุชูุซูู ุดุงูู

**ุงูุญุงูุฉ:**
๐ข ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูููุฑู!

**ุงููููุงุช ุงูููุถุงูุฉ/ุงูููุนุฏููุฉ:**
1. โ `convex/schema.ts` - ุฌุฏูู emailSettings
2. โ `convex/emailSettings.ts` - Backend functions
3. โ `src/pages/system-support/page.tsx` - Settings Tab
4. โ `EMAIL_SETTINGS_GUIDE.md` - ูุฐุง ุงูููู

---

**Ready to use!** ๐๐ง
