# 🔐 دليل الوصول إلى مسير الرواتب

## نظام الحماية الكامل

صفحة مسير الرواتب محمية بـ **3 طبقات أمان**:

---

## 🔒 **الطبقة 1: تسجيل الدخول (Hercules Auth)**

### المتطلب:
- تسجيل دخول عبر Hercules Auth (Google, Microsoft, or Email)

### كيف يعمل:
```
1. المستخدم يزور /payroll
2. إذا لم يكن مسجل دخول:
   → يظهر زر "Sign In"
   → يطلب تسجيل الدخول
3. بعد النجاح:
   → ينتقل إلى الطبقة 2
```

---

## 🔐 **الطبقة 2: كلمة مرور الأدمن**

### المتطلب:
- كلمة المرور: `Omar1010#`

### كيف يعمل:
```
1. بعد تسجيل الدخول
2. تظهر شاشة "حماية مسير الرواتب"
3. المستخدم يدخل كلمة المرور
4. إذا كانت صحيحة:
   ✅ يتم التحقق ويُحفظ في sessionStorage
   ✅ ينتقل إلى صفحة مسير الرواتب
5. إذا كانت خاطئة:
   ❌ رسالة خطأ
   ❌ يجب المحاولة مرة أخرى
```

### ملاحظات مهمة:
- ✅ كلمة المرور محفوظة لمدة الجلسة (session)
- ✅ لن يطلب إعادة إدخال كلمة المرور في نفس التاب
- ❌ عند إغلاق التاب/المتصفح، يجب إعادة إدخال كلمة المرور
- ❌ في تاب جديد، يجب إعادة إدخال كلمة المرور

---

## 🏢 **الطبقة 3: اختيار الفرع**

### المتطلب:
- اختيار الفرع من Branch Selector

### كيف يعمل:
```
1. بعد التحقق من كلمة المرور
2. يظهر Branch Selector في الأعلى
3. المستخدم يختار الفرع
4. تظهر بيانات مسير الرواتب للفرع المحدد
```

---

## 📊 **تدفق الوصول الكامل**

```
زيارة /payroll
    ↓
هل مسجل دخول؟
    ↓ لا
    تسجيل الدخول (Hercules Auth)
    ↓ نعم
هل تم التحقق من كلمة المرور؟
    ↓ لا
    إدخال كلمة مرور الأدمن (Omar1010#)
    ↓ نعم
هل تم اختيار الفرع؟
    ↓ لا
    اختيار الفرع
    ↓ نعم
✅ عرض مسير الرواتب
```

---

## 🔑 **معلومات كلمة المرور**

### كلمة المرور:
```
Omar1010#
```

### خصائص:
- ✅ حساسة لحالة الأحرف (Case-sensitive)
- ✅ يجب كتابتها بالضبط كما هي
- ✅ تحتوي على:
  - حرف كبير: O
  - أحرف صغيرة: mar
  - أرقام: 1010
  - رمز خاص: #

### أمثلة خاطئة:
```
❌ omar1010#  (O صغيرة)
❌ Omar1010   (بدون #)
❌ OMAR1010#  (كل الحروف كبيرة)
❌ Omar1010#  (مسافة في النهاية)
```

---

## 🔐 **الأمان**

### ما هو محمي:
1. ✅ الوصول إلى صفحة مسير الرواتب
2. ✅ عرض بيانات الرواتب
3. ✅ إنشاء مسير رواتب جديد
4. ✅ تصدير PDF
5. ✅ حذف مسير رواتب

### كيف يعمل الأمان:
```typescript
// الكود في src/pages/payroll/page.tsx

1. Authenticated component (Hercules Auth)
2. PayrollPageWithPassword component (Password check)
3. sessionStorage للحفظ المؤقت
4. PayrollPageContent (المحتوى الفعلي)
```

### تخزين الحالة:
```javascript
// في sessionStorage:
sessionStorage.setItem("payroll_admin_verified", "true");

// يتم المسح عند:
- إغلاق التاب
- إغلاق المتصفح
- تسجيل الخروج
- مسح البيانات
```

---

## 🎯 **حالات الاستخدام**

### ✅ **السيناريو العادي:**
```
1. مدير يزور /payroll
2. يسجل دخول بحساب Google
3. يدخل كلمة المرور: Omar1010#
4. يختار الفرع (مثلاً: لبن)
5. يعرض/يُنشئ/يُصدر مسير الرواتب
6. كل شيء يعمل في نفس الجلسة
```

### ❌ **سيناريو محاولة غير مصرح بها:**
```
1. موظف يزور /payroll
2. يسجل دخول بحسابه
3. لا يعرف كلمة المرور
4. ❌ لا يستطيع الدخول
5. ❌ محمي تماماً
```

### 🔄 **سيناريو جلسة جديدة:**
```
1. مدير سجل دخول ودخل كلمة المرور
2. يعمل على النظام
3. يغلق التاب
4. يفتح /payroll مرة أخرى
5. ✅ لا يزال مسجل دخول
6. ❌ يجب إعادة إدخال كلمة المرور
7. يدخل Omar1010# مرة أخرى
8. ✅ يدخل للنظام
```

---

## 🛠️ **تغيير كلمة المرور**

### الطريقة:
1. افتح: `src/pages/payroll/page.tsx`
2. ابحث عن السطر:
   ```typescript
   if (password === "Omar1010#") {
   ```
3. غيّر `"Omar1010#"` إلى كلمة المرور الجديدة
4. احفظ الملف

### مثال:
```typescript
// قبل
if (password === "Omar1010#") {

// بعد
if (password === "NewPassword123!") {
```

---

## ⚠️ **ملاحظات مهمة**

### 1. الأمان في الإنتاج:
- ✅ كلمة المرور في الكود آمنة للاستخدام الداخلي
- ⚠️ للتطبيقات العامة، استخدم تشفير وhashing

### 2. sessionStorage vs localStorage:
- ✅ استخدمنا sessionStorage (أكثر أماناً)
- ✅ يُمسح تلقائياً عند إغلاق التاب
- ❌ localStorage يبقى حتى بعد الإغلاق (أقل أماناً)

### 3. الوصول من أجهزة متعددة:
- ✅ كل جهاز منفصل
- ✅ كل تاب منفصل
- ✅ يجب إدخال كلمة المرور في كل جهاز/تاب جديد

---

## 🎉 **الخلاصة**

### ✅ ما تم إنجازه:
```
✅ طبقة 1: Hercules Auth
✅ طبقة 2: كلمة مرور الأدمن (Omar1010#)
✅ طبقة 3: اختيار الفرع
✅ حفظ الحالة في sessionStorage
✅ واجهة احترافية للباسوورد
✅ رسائل خطأ واضحة
✅ toast notifications
✅ تجربة مستخدم سلسة
```

### 🔐 **مستوى الحماية:**
```
مرتفع جداً ✅
- 3 طبقات أمان
- تسجيل دخول + باسوورد + فرع
- sessionStorage للأمان
- حماية كاملة للبيانات الحساسة
```

---

**📧 للأسئلة أو المساعدة، راجع:** [`src/pages/payroll/page.tsx`](file://src/pages/payroll/page.tsx)
