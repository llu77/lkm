# ๐ค ุฏููู ุฃุชูุชุฉ ูุณูุฑ ุงูุฑูุงุชุจ ุงูุดูุฑู

## โ **ูุง ุชู ุฅูุฌุงุฒู:**

ุชู ุฅุถุงูุฉ ูุธุงู ุฃุชูุชุฉ ูุงูู ููุณูุฑ ุงูุฑูุงุชุจ ุงูุดูุฑู ูุนูู ุชููุงุฆูุงู ูู ุชุงุฑูุฎ **1 ูู ูู ุดูุฑ @ 4:00 AM**.

---

## ๐ **ุงููููุงุช ุงูููุถุงูุฉ:**

### **1. convex/payrollAutomation.ts**
**ุงููุธููุฉ:** ูููู ุงูุฃุชูุชุฉ ุงูุดูุฑู  
**ุงูุญุฌู:** 413 ุณุทุฑ

**ุงููุธุงุฆู:**
- `generateMonthlyPayrollForAllBranches` - ุฅูุดุงุก ูุณูุฑ ุฑูุงุชุจ ูุฌููุน ุงููุฑูุน
- `sendMonthlyPayrollEmails` - ุฅุฑุณุงู ุฅููููุงุช ุจูููุงุช PDF

---

## ๐ **ููู ูุนูู ุงููุธุงู:**

### **ููู 1 ูู ูู ุดูุฑ @ 4:00 AM:**

```
1. โฐ Zapier Schedule ููุฑุณู webhook

2. ๐ค generateMonthlyPayrollForAllBranches ูุจุฏุฃ ุงูุนูู:
   โโ ูุฌูุจ ุฌููุน ุงูููุธููู ุงููุดุทูู
   โโ ููุฌููุนูู ุญุณุจ ุงููุฑุน
   โโ ููู ูุฑุน:
      โโ ูุฌูุน ุงูุณูู ูุงูุฎุตููุงุช ููุดูุฑ
      โโ ูุญุณุจ ุงูุตุงูู ููู ููุธู
      โโ ูููุดุฆ ุณุฌู ูุณูุฑ ุฑูุงุชุจ

3. โฑ๏ธ ุจุนุฏ ุฏูููุฉ ูุงุญุฏุฉ:
   โโ sendMonthlyPayrollEmails ูุจุฏุฃ:
      โโ ูููุดุฆ PDF ููู ูุฑุน (Symbol AI)
      โโ ููุฑุณู ุจุฑูุฏ ุงุญุชุฑุงูู ูุน PDF
      โโ ููุญุฏูุซ ุญุงูุฉ ุงูุจุฑูุฏ

4. โฑ๏ธ ุจุนุฏ ุฏูููุชูู:
   โโ createManualBackup:
      โโ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ุชููุงุฆูุฉ

5. ๐ ุฅุฑุณุงู webhook ูู Zapier:
   โโ ุฅุดุนุงุฑ ุจุฅุชูุงู ุงูุนูููุฉ
```

---

## ๐ฏ **Setup Instructions:**

### **Step 1: ุชุฃูุฏ ูู ุฅุนุฏุงุฏุงุช ุงูุจุฑูุฏ**

ุงุฐูุจ ุฅูู `/system-support` โ ุชุงุจ "ุฅุนุฏุงุฏุงุช":

```
โ ุงููุฑุณู ุงูุงูุชุฑุงุถู
โ ุงููุณุชูููู ุงูุงูุชุฑุงุถููู
โ ูุญุชูู ุงูุจุฑูุฏ (optional)
```

---

### **Step 2: Setup Zapier Schedule**

#### **ุฅูุดุงุก Zap ุฌุฏูุฏ:**

```
Trigger: Schedule by Zapier
  - Frequency: Every Month
  - Day: 1
  - Time: 4:00 AM
  - Timezone: Asia/Riyadh

Action: Webhooks by Zapier
  - Method: POST
  - URL: [Your Convex HTTP endpoint]
  - Body Type: JSON
  - Data:
    {
      "action": "generate_monthly_payroll",
      "month": "{{zap_meta_timestamp__month}}",
      "year": "{{zap_meta_timestamp__year}}"
    }

Action 2: Email by Zapier (optional)
  - To: Admin email
  - Subject: "โ ุชู ุฅูุดุงุก ูุณูุฑ ุงูุฑูุงุชุจ - {{zap_meta_timestamp__month}}/{{zap_meta_timestamp__year}}"
  - Body: "ุชู ุฅูุดุงุก ูุณูุฑ ุฑูุงุชุจ ุงูุดูุฑ ุงููุงุถู ุจูุฌุงุญ"
```

---

### **Step 3: ุงุฎุชุจุงุฑ ูุฏูู**

ููููู ุงุฎุชุจุงุฑ ุงููุธุงู ูุฏููุงู ูู Convex Dashboard:

```javascript
// ูู Convex Dashboard โ Functions
// ุงุถุบุท Run ุนูู:
internal.payrollAutomation.generateMonthlyPayrollForAllBranches

// Arguments (optional):
{
  "month": 12,  // ุฏูุณูุจุฑ (optionalุ default = last month)
  "year": 2024  // (optionalุ default = current year)
}
```

---

## ๐ง **ูููุฐุฌ ุงูุจุฑูุฏ ุงูููุฑุณู:**

### **Subject:**
```
ูุณูุฑ ุฑูุงุชุจ [ุงุณู ุงููุฑุน] - [ุงูุดูุฑ] [ุงูุณูุฉ]
```

### **Content:**
```html
โก Symbol AI
ูุธุงู ุงูุฅุฏุงุฑุฉ ุงููุงููุฉ
ูุณูุฑ ุฑูุงุชุจ ุงูููุธููู

ุงูุณูุงู ุนูููู ูุฑุญูุฉ ุงููู ูุจุฑูุงุชูุ

ูุญูุทูู ุนููุงู ุจุฃูู ุชู ุฅูุดุงุก ูุณูุฑ ุฑูุงุชุจ ุงูููุธููู ููุดูุฑ ุงููุงุถู.

ุงููุฑุน: [ุงุณู ุงููุฑุน]
ุงูุดูุฑ: [ููููุจุฑ 2025]
ุนุฏุฏ ุงูููุธููู: [15 ููุธู]
ุฅุฌูุงูู ุงูุฑูุงุชุจ: [75,000 ุฑ.ุณ]

ููููู ุชุญููู ููู PDF ุงููุงูู ูู ุงูุฑุงุจุท ุฃุฏูุงู:
[ุชุญููู ูุณูุฑ ุงูุฑูุงุชุจ (PDF)]

ุชู ุฅูุดุงุก ูุฐุง ุงููุณูุฑ ุชููุงุฆูุงู ุจูุงุณุทุฉ Symbol AI ูู [ุงูุชุงุฑูุฎ].
```

---

## ๐ **ุงูุญุณุงุจ ุงูุชููุงุฆู:**

ููู ููุธู:

```typescript
ุงูุตุงูู = ุงูุฑุงุชุจ ุงูุฃุณุงุณู 
         + ุจุฏู ุงูุฅุดุฑุงู 
         + ุงูุญูุงูุฒ
         - ุงูุณูู (ููุดูุฑ ุงููุญุฏุฏ)
         - ุงูุฎุตููุงุช (ููุดูุฑ ุงููุญุฏุฏ)
```

**ูุซุงู:**
```
ููุธู: ุนุจุฏุงูุญู ุฌูุงู (ูุฑุน ูุจูุ ูุดุฑู)

ุงูุฑุงุชุจ ุงูุฃุณุงุณู:   2,000 ุฑ.ุณ
ุจุฏู ุงูุฅุดุฑุงู:       400 ุฑ.ุณ
ุงูุญูุงูุฒ:             0 ุฑ.ุณ
ุงูุณูู:            -300 ุฑ.ุณ (ุณููุฉ ููููุจุฑ)
ุงูุฎุตููุงุช:           -0 ุฑ.ุณ
โโโโโโโโโโโโโโโโโโโโโโโโโ
ุงูุตุงูู:          2,100 ุฑ.ุณ
```

---

## ๐ฏ **ุงูููุฒุงุช:**

### **โ 1. ุฃุชูุชุฉ ูุงููุฉ**
- ูุง ูุญุชุงุฌ ุชุฏุฎู ูุฏูู
- ูุนูู ุชููุงุฆูุงู ูู ุดูุฑ
- ูููุดุฆ ูุณูุฑ ุฑูุงุชุจ ูุฌููุน ุงููุฑูุน

### **โ 2. PDF ุงุญุชุฑุงูู**
- ุชุตููู ุงุญุชุฑุงูู ูุน Symbol AI logo
- ุฌุฏูู ูุงูู ุจุฌููุน ุงูููุธููู
- RTL support ูุงูู
- Cairo font

### **โ 3. ุจุฑูุฏ ุฅููุชุฑููู ุงุญุชุฑุงูู**
- ุชุตููู responsive
- ุฑุงุจุท ุชุญููู ูุจุงุดุฑ ููPDF
- ูุนูููุงุช ุดุงููุฉ

### **โ 4. ูุณุฎ ุงุญุชูุงุทูุฉ ุชููุงุฆูุฉ**
- ุจุนุฏ ูู ูุณูุฑ ุฑูุงุชุจ
- ุญูุธ 90 ููู

### **โ 5. Zapier webhook**
- ุฅุดุนุงุฑ ุชููุงุฆู
- ูููู ุฑุจุทู ุจู:
  - Google Drive
  - Slack
  - Email
  - ุฃู ุฎุฏูุฉ ุฃุฎุฑู

---

## โ๏ธ **ุงูุฅุนุฏุงุฏุงุช ุงููุชูุฏูุฉ:**

### **ุชุฎุตูุต ููุช ุงูุชุดุบูู:**
```
ูู Zapier Schedule:
- ููููู ุชุบููุฑ ุงูููู (1-28)
- ููููู ุชุบููุฑ ุงูููุช (4:00 AM โ ุฃู ููุช)
- ููููู ุชุบููุฑ timezone
```

### **ุชุฎุตูุต ุงููุณุชูููู:**
```
ูู /system-support โ ุฅุนุฏุงุฏุงุช:
- ุฅุถุงูุฉ/ุญุฐู ูุณุชูููู
- ูููู ุฅุถุงูุฉ ูุชุนุฏุฏูู
```

### **ุชุฎุตูุต ูุญุชูู ุงูุจุฑูุฏ:**
```javascript
// ูู convex/payrollAutomation.ts
// ุงูุณุทุฑ 241-330
// ููููู ุชุนุฏูู HTML template
```

---

## ๐ **ูุซุงู Zapier Webhook Payload:**

ุนูุฏ ุฅุชูุงู ุงูุนูููุฉุ ููุฑุณู webhook ุฅูู Zapier:

```json
{
  "eventType": "monthly_payroll_generated",
  "payload": {
    "month": 11,
    "year": 2024,
    "monthName": "ููููุจุฑ",
    "totalPayrolls": 3,
    "successCount": 3,
    "failCount": 0,
    "timestamp": "2024-12-01T04:05:30.123Z"
  }
}
```

---

## ๐งช **Testing:**

### **Test 1: ูุฏูู ูู Dashboard**
```
1. Convex Dashboard
2. Functions โ internal.payrollAutomation.generateMonthlyPayrollForAllBranches
3. Run
4. ุชุญูู ูู ุงููุชุงุฆุฌ
```

### **Test 2: ูู Zapier**
```
1. Zapier Dashboard
2. ุงุถุบุท "Test Trigger"
3. ุชุญูู ูู Logs
```

### **Test 3: ุงูุชุธุงุฑ ุชุงุฑูุฎ 1**
```
1. ุงูุชุธุฑ ุญุชู 1 @ 4:00 AM
2. ุชุญูู ูู Email
3. ุชุญูู ูู /payroll
```

---

## โ **ููุงุญุธุงุช ูููุฉ:**

### **1. ุงูููุธููู ุงููุดุทูู ููุท**
- ููุท ุงูููุธููู `isActive: true`
- ุงูููุธููู ุงููุญุฐูููู ูุง ููุฏุฑุฌูู

### **2. ุงูุณูู ูุงูุฎุตููุงุช**
- ูุชู ุฌูุน ุงูุณูู **ููุดูุฑ ุงููุญุฏุฏ ููุท**
- ูุชู ุฌูุน ุงูุฎุตููุงุช **ููุดูุฑ ุงููุญุฏุฏ ููุท**
- ูุซุงู: ูุณูุฑ ููููุจุฑ ูุดูู ููุท ุณูู ููููุจุฑ

### **3. ุฅุนุงุฏุฉ ุงูุชุดุบูู**
- ุฅุฐุง ูุดู ุงูุจุฑูุฏุ ูู ููุนุงุฏ ุฅุฑุณุงูู ุชููุงุฆูุงู
- ููููู ุฅุนุงุฏุฉ ุงูุชุดุบูู ูุฏููุงู

### **4. ุงููุฑูุน ุงููุงุฑุบุฉ**
- ุงููุฑูุน ุจุฏูู ููุธููู ูุดุทูู **ุชูุชุฌุงูู**

---

## ๐ **ุงูุฎูุงุตุฉ:**

```
โ ูุธุงู ุฃุชูุชุฉ ูุงูู
โ ูุนูู ุชููุงุฆูุงู ูู ุดูุฑ
โ PDF ุงุญุชุฑุงูู ูุน Symbol AI
โ ุจุฑูุฏ ุฅููุชุฑููู ุงุญุชุฑุงูู
โ ูุณุฎ ุงุญุชูุงุทูุฉ ุชููุงุฆูุฉ
โ Zapier webhooks
โ ุฌุงูุฒ ููุฅูุชุงุฌ 100%
```

---

## ๐ **ุงูุฏุนู:**

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ุชุญูู ูู Convex logs
2. ุชุญูู ูู Zapier task history
3. ุชุญูู ูู /backups ูุขุฎุฑ ูุณุฎุฉ ุงุญุชูุงุทูุฉ

---

**๐ ุงููุธุงู ุงูุขู ููุชูู ููุนูู ุจุดูู ุชููุงุฆู!** ๐
