---
title: "Reference: Memory.query() | Memory | Mastra Docs"
description: Documentation for the `Memory.query()` method in Mastra, which retrieves messages from a specific thread with support for pagination, filtering options, and semantic search.
---

# Memory.query()

The `.query()` method retrieves messages from a specific thread, with support for pagination, filtering options, and semantic search.

## Usage Example

```typescript
await memory?.query({ threadId: "user-123" });
```

## Parameters

| Parameter | Type | Optional | Description |
|-----------|------|----------|-------------|
| `threadId` | `string` | No | The unique identifier of the thread to retrieve messages from |
| `resourceId` | `string` | Yes | Optional ID of the resource that owns the thread. If provided, validates thread ownership |
| `selectBy` | `object` | Yes | Options for filtering and selecting messages |
| `threadConfig` | `MemoryConfig` | Yes | Configuration options for message retrieval and semantic search |
| `format` | `'v1' \| 'v2'` | Yes | Message format to return. Defaults to 'v2' for current format, 'v1' for backwards compatibility |

## selectBy parameters

| Parameter | Type | Optional | Description |
|-----------|------|----------|-------------|
| `vectorSearchString` | `string` | Yes | Search string for finding semantically similar messages. Requires semantic recall to be enabled in threadConfig. |
| `last` | `number \| false` | Yes | Number of most recent messages to retrieve. Set to false to disable limit. Note: threadConfig.lastMessages (default: 10) will override this if smaller. |
| `include` | `{ id: string; threadId?: string; withPreviousMessages?: number; withNextMessages?: number }[]` | Yes | Array of specific message IDs to include with optional context messages. Each item has an id (required), optional threadId (defaults to main threadId), withPreviousMessages (number of messages before, defaults to 2 for vector search, 0 otherwise), and withNextMessages (number of messages after, defaults to 2 for vector search, 0 otherwise). |
| `pagination` | `{ dateRange?: { start?: Date; end?: Date }; page?: number; perPage?: number }` | Yes | Pagination options for retrieving messages in batches. Includes dateRange (filter by date range), page (0-based page number), and perPage (messages per page). |

## threadConfig parameters

| Parameter | Type | Optional | Default | Description |
|-----------|------|----------|---------|-------------|
| `lastMessages` | `number \| false` | Yes | `10` | Number of most recent messages to retrieve. Set to false to disable. |
| `semanticRecall` | `boolean \| { topK: number; messageRange: number \| { before: number; after: number }; scope?: 'thread' \| 'resource' }` | Yes | `false` | Enable semantic search in message history. Can be a boolean or an object with configuration options. When enabled, requires both vector store and embedder to be configured. |
| `workingMemory` | `WorkingMemory` | Yes | `{ enabled: false, template: '# User Information\n- First Name:\n- Last Name:\n...' }` | Configuration for working memory feature. Can be { enabled: boolean; template?: string; schema?: ZodObject<any> \| JSONSchema7; scope?: 'thread' \| 'resource' } or { enabled: boolean } to disable. |
| `threads` | `{ generateTitle?: boolean \| { model: DynamicArgument; instructions?: DynamicArgument } }` | Yes | `{ generateTitle: false }` | Settings related to memory thread creation. generateTitle controls automatic thread title generation from the user's first message. Can be a boolean or an object with custom model and instructions. |

## Returns

Returns a Promise that resolves to an array of messages from the specified thread, formatted according to the specified format parameter (v1 or v2).
